<!DOCTYPE html>
<html lang="tr">

<head>
  <%- include('../includes/head.ejs') %>
  <title>Admin</title>
</head>

<body class="bg-dark">
  <%- include('../includes/navbar.ejs') %>
  <div>
    <div class="header">
      <h1>Scoreboard</h1>
    </div>
  </div>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-12 mb-5">
        <div class="card dark">
          <div class="card-header dark">
            <h3 class="card-title">Takım Sıralaması</h3>
          </div>
          <div class="card-body dark">

            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">Sıra</th>
                  <th scope="col">Takım Adı</th>
                  <th scope="col">Puan</th>
                  <th scope="col">Görüntüle</th>
                </tr>
              </thead>
              <tbody>
                <% for( let team = 0; team < teams.length; team++ ) { %>

                <tr>
                  <td><%= team+1 %></td>
                  <td><%= teams[team].name %></td>
                  <td><%= teams[team].points %></td>
                  <td>
                    <a href="/teams/<%= teams[team].id  %> " class="btn btn-info"><i class="fa-solid fa-up-right-from-square"></i></a>
                  </td>
                </tr>

                <% } %>
              </tbody>
            </table>

          </div>
        </div>
      </div>
      <div class="col-md-12 mb-5">
        <div class="card dark">
          <div class="card-header dark">
            <h3 class="card-title">En Çok Puan Toplayanlar</h3>
          </div>
          <div class="card-body dark">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">Sıra</th>
                  <th scope="col">Kullanıcı Adı</th>
                  <th scope="col">Puanı</th>
                  <th scope="col">Takım Adı</th>
                  <th scope="col">Görüntüle</th>

                </tr>
              </thead>
              <tbody>
                <% for( let index = 0; index < users.length; index++ ) { %>


                <tr>
                  <td><%= index+1 %></td>
                  <td><%= users[index].username %></td>
                  <td><%= users[index].point %></td>
                  <td><%= users[index].teamName %></td>
                  <td class="flex-row">
                    <a href="/users/<%= users[index].id  %> " class="btn btn-info"><i class="fa-solid fa-up-right-from-square"></i></a>
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
    </div>
</body>
<%- include('../includes/jss.ejs') %>
<script>

  $('.down').click(function() {
    var $tr = $(this).parent();

    if ($tr.is(':last-child'))
      $tbody.prepend($tr);
    else
      $tr.insertAfter($tr.next());
  });

  function verifyUser(userID, verify) {
    var data = {
      userID: userID,
      verify: verify,
    };
    $.ajax({
      type: "POST",
      url: "/api/admin/verifyuser",
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      async: false,
      success: function(data) {
        if (data.message == "No user") {
          Swal.fire({
            icon: "error",
            title: "Hata",
            text: "Kullanıcı bulunamadı",
          });
        } else if (data.message == "ok") {
          Swal.fire({
            icon: "success",
            title: "Muhteşem!",
            text: "Doğrulanma durumu değiştirildi",
          }).then(
            setTimeout(function() {
              window.location.href = "/admin";
            }, 2000)
          );
        }
      },
    });
  }

  function verifyTeam(teamID, verify) {
    var data = {
      teamID: teamID,
      verify: verify,
    };
    $.ajax({
      type: "POST",
      url: "/api/admin/verifyteam",
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      async: false,
      success: function(data) {
        if (data.message == "No team") {
          Swal.fire({
            icon: "error",
            title: "Hata",
            text: "Takım bulunamadı",
          });
        } else if (data.message == "ok") {
          Swal.fire({
            icon: "success",
            title: "Muhteşem!",
            text: "Doğrulanma durumu değiştirildi",
          }).then(
            setTimeout(function() {
              window.location.href = "/admin";
            }, 2000)
          );
        }
      },
    });
  }

  function adminUser(userID, admin) {
    var data = {
      userID: userID,
      admin: admin,
    };
    $.ajax({
      type: "POST",
      url: "/api/admin/changeadmin",
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      async: false,
      success: function(data) {
        if (data.message == "No user") {
          Swal.fire({
            icon: "error",
            title: "Hata",
            text: "Kullanıcı bulunamadı",
          });
        } else if (data.message == "ok") {
          Swal.fire({
            icon: "success",
            title: "Muhteşem!",
            text: "Adminlik durumu değiştirildi",
          }).then(
            setTimeout(function() {
              window.location.href = "/admin";
            }, 2000)
          );
        }
      },
    });
  }

  function deleteUser(userID) {
    var data = {
      userID: userID,
    };
    $.ajax({
      type: "POST",
      url: "/api/admin/deleteuser",
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      async: false,
      success: function(data) {
        if (data.message == "No user") {
          Swal.fire({
            icon: "error",
            title: "Hata",
            text: "Kullanıcı bulunamadı",
          });
        } else if (data.message == "ok") {
          Swal.fire({
            icon: "success",
            title: "Başarılı!",
            text: "Kullanıcı silindi",
          }).then(
            setTimeout(function() {
              window.location.href = "/admin";
            }, 2000)
          );
        }
      },
    });
  }
</script>

</html>